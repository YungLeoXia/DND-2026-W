@page "/register"
@inject AuthService Auth
@inject NavigationManager Nav

<div class="auth-page">
    <div class="auth-card">
        <h1 class="auth-title">Create Account</h1>
        
        @if (!string.IsNullOrEmpty(_error))
        {
            <div class="alert alert-error">@_error</div>
        }
        
        @if (_success)
        {
            <div class="alert alert-success">Registration successful! You can now sign in.</div>
        }
        
        <EditForm Model="_model" OnValidSubmit="HandleRegister">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div class="form-group">
                    <label>First Name</label>
                    <InputText @bind-Value="_model.FirstName" placeholder="John" />
                </div>
                <div class="form-group">
                    <label>Last Name</label>
                    <InputText @bind-Value="_model.LastName" placeholder="Doe" />
                </div>
            </div>
            
            <div class="form-group">
                <label>Email</label>
                <InputText @bind-Value="_model.Email" placeholder="you@example.com" />
            </div>
            
            <div class="form-group">
                <label>Password</label>
                <InputText @bind-Value="_model.Password" type="password" placeholder="••••••••" />
            </div>
            
            <button type="submit" class="btn btn-primary" style="width: 100%;" disabled="@_loading">
                @if (_loading) { <span>Creating account...</span> } else { <span>Create Account</span> }
            </button>
        </EditForm>
        
        <div class="auth-footer">
            Already have an account? <a href="/login">Sign In</a>
        </div>
    </div>
</div>

@code {
    private RegisterModel _model = new();
    private string? _error;
    private bool _loading;
    private bool _success;

    private async Task HandleRegister()
    {
        _error = null;
        _success = false;
        _loading = true;
        
        var (success, error) = await Auth.RegisterAsync(_model.Email, _model.Password, _model.FirstName, _model.LastName);
        
        if (success)
        {
            _success = true;
            _model = new();
        }
        else
        {
            _error = error;
        }
        
        _loading = false;
    }

    private class RegisterModel
    {
        public string Email { get; set; } = "";
        public string Password { get; set; } = "";
        public string FirstName { get; set; } = "";
        public string LastName { get; set; } = "";
    }
}

