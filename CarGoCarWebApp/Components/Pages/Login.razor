@page "/login"
@inject AuthService Auth
@inject NavigationManager Nav

<div class="auth-page">
    <div class="auth-card">
        <h1 class="auth-title">Sign In</h1>
        
        @if (!string.IsNullOrEmpty(_error))
        {
            <div class="alert alert-error">@_error</div>
        }
        
        <EditForm Model="_model" OnValidSubmit="HandleLogin">
            <div class="form-group">
                <label>Email</label>
                <InputText @bind-Value="_model.Email" placeholder="you@example.com" />
            </div>
            
            <div class="form-group">
                <label>Password</label>
                <InputText @bind-Value="_model.Password" type="password" placeholder="••••••••" />
            </div>
            
            <button type="submit" class="btn btn-primary" style="width: 100%;" disabled="@_loading">
                @if (_loading) { <span>Signing in...</span> } else { <span>Sign In</span> }
            </button>
        </EditForm>
        
        <div class="auth-footer">
            Don't have an account? <a href="/register">Register</a>
        </div>

        <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--border);">
            <p style="color: var(--text-dim); font-size: 13px; margin-bottom: 8px;">Test accounts:</p>
            <div style="font-size: 12px; color: var(--text-dim);">
                <div>admin@cargocar.com / admin123</div>
                <div>john@example.com / pass123 (Driver)</div>
                <div>bob@example.com / pass123 (Passenger)</div>
            </div>
        </div>
    </div>
</div>

@code {
    private LoginModel _model = new();
    private string? _error;
    private bool _loading;

    private async Task HandleLogin()
    {
        _error = null;
        _loading = true;
        
        var (success, error) = await Auth.LoginAsync(_model.Email, _model.Password);
        
        if (success)
            Nav.NavigateTo("/");
        else
            _error = error;
        
        _loading = false;
    }

    private class LoginModel
    {
        public string Email { get; set; } = "";
        public string Password { get; set; } = "";
    }
}

